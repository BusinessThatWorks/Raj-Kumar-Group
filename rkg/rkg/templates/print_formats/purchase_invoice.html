{%- set company = frappe.get_doc("Company", doc.company) -%}
{%- set supplier = frappe.get_doc("Supplier", doc.supplier) if doc.supplier else None -%}

<style>
/* ================= PAGE SETTINGS ================= */
@page {
    size: A4 landscape;
    margin: 10mm 8mm;
}

body {
    font-family: "Helvetica", "Arial", sans-serif;
    font-size: 10px;
    color: #000;
    line-height: 1.4;
}

/* ================= WRAPPER ================= */
.wrapper {
    width: 100%;
}

/* ================= HEADER ================= */
.header {
    display: flex;
    justify-content: space-between;
    border-bottom: 2px solid #000;
    padding-bottom: 8px;
    margin-bottom: 12px;
}

.company-details {
    display: flex;
    flex-direction: column;
}

.company-name {
    font-size: 18px;
    font-weight: bold;
    text-transform: uppercase;
}

.company-address {
    font-size: 9px;
    margin-top: 2px;
    line-height: 1.2;
}

.doc-title {
    font-size: 16px;
    font-weight: bold;
    text-transform: uppercase;
    text-align: center;
}

/* ================= INFO (2-COLUMN CARDS) ================= */
.info-grid {
    width: 100%;
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    margin-bottom: 12px;
}

.info-card {
    width: 100%;
    border-collapse: collapse;
    background: #fff;
    border: 1px solid #ddd;
}

.info-card th {
    text-align: left;
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    padding: 6px 8px;
    background: #f2f2f2;
    border-bottom: 1px solid #ddd;
}

.info-card td {
    padding: 6px 8px;
    vertical-align: top;
}

.info-card .label {
    width: 30%;
    font-weight: 600;
    color: #444;
}

.info-card .value {
    color: #000;
}

/* ================= SECTION LINE ================= */
.section-line {
    border-top: 2px solid #000;
    margin: 10px 0;
}

/* ================= ITEMS TABLE ================= */
.items {
    width: 100%;
    border-collapse: collapse;
    table-layout: fixed;
    margin-bottom: 10px;
}

.items th, .items td {
    padding: 6px 4px;
    vertical-align: top;
    word-wrap: break-word;
    border-bottom: 1px solid #e3e3e3;
}

.items th {
    font-size: 9px;
    font-weight: bold;
    text-align: center;
    background-color: #f7f7f7;
    border-bottom: 1.5px solid #000;
}

.items td {
    font-size: 9px;
    text-align: left;
}

.items tbody tr:last-child td {
    border-bottom: 1.5px solid #000;
}

.text-center { text-align: center; }
.text-right { text-align: right; }

.serial {
    font-family: "Courier New", monospace;
    font-size: 8.5px;
}

/* Explicit column widths */
.items th:nth-child(1), .items td:nth-child(1) { width: 3%; text-align:center; }
.items th:nth-child(2), .items td:nth-child(2) { width: 12%; text-align:center; }
.items th:nth-child(3), .items td:nth-child(3) { width: 25%; }
.items th:nth-child(4), .items td:nth-child(4) { width: 5%; text-align:center; }
.items th:nth-child(5), .items td:nth-child(5) { width: 5%; text-align:center; }
.items th:nth-child(6), .items td:nth-child(6) { width: 8%; text-align:right; }
.items th:nth-child(7), .items td:nth-child(7) { width: 8%; text-align:right; }
.items th:nth-child(8), .items td:nth-child(8) { width: 8%; text-align:right; }
.items th:nth-child(9), .items td:nth-child(9) { width: 8%; text-align:right; }
.items th:nth-child(10), .items td:nth-child(10) { width: 18%; }

/* ================= TOTALS ================= */
.totals {
    width: 40%;
    margin-left: auto;
    margin-top: 6px;
    border-collapse: collapse;
}

.totals td {
    padding: 4px 6px;
    font-size: 10px;
    border: none;
}

.totals .label {
    text-align: right;
    font-weight: bold;
}

.totals .value {
    text-align: right;
}

.totals .grand {
    border-top: 1.5px solid #000;
    font-size: 11px;
    font-weight: bold;
}

/* ================= FOOTER ================= */
.footer {
    margin-top: 12px;
    padding-top: 6px;
    border-top: 1px solid #000;
    display: flex;
    justify-content: space-between;
    font-size: 9px;
}

.footer div {
    width: 48%;
}
</style>

<div class="wrapper">

    <!-- HEADER -->
    <div class="header">
        <div class="company-details">
            <div class="company-name">{{ company.company_name }}</div>
            <div class="company-address">{{ company.address_display }}</div>
        </div>
        <div class="doc-title">Purchase Invoice</div>
    </div>

    <!-- INFO GRID -->
    <div class="info-grid">
        <table class="info-card">
            <tr>
                <th colspan="2">Shipping & Supplier</th>
            </tr>
            <tr>
                <td class="label">Supplier</td>
                <td class="value">
                    {{ doc.supplier_name }}<br>
                    {{ doc.supplier_address_display or "-" }}
                </td>
            </tr>
            <tr>
                <td class="label">Shipping Address</td>
                <td class="value">{{ doc.shipping_address_display or "-" }}</td>
            </tr>
            <tr>
                <td class="label">GSTIN</td>
                <td class="value">{{ supplier.gstin if supplier and supplier.gstin else "-" }}</td>
            </tr>
        </table>

        <table class="info-card">
            <tr>
                <th colspan="2">Billing & Document</th>
            </tr>
            <tr>
                <td class="label">Billing Address</td>
                <td class="value">{{ doc.billing_address_display or "-" }}</td>
            </tr>
            <tr>
                <td class="label">Invoice No</td>
                <td class="value">{{ doc.name }}</td>
            </tr>
            <tr>
                <td class="label">Posting Date</td>
                <td class="value">{{ doc.posting_date }}</td>
            </tr>
            <tr>
                <td class="label">Bill No / Date</td>
                <td class="value">{{ doc.bill_no or "-" }} / {{ doc.bill_date or "-" }}</td>
            </tr>
        </table>
    </div>

    <div class="section-line"></div>

    <!-- ITEMS TABLE -->
    <table class="items">
        <thead>
            <tr>
                <th>Sr</th>
                <th>Item Code</th>
                <th>Item Description</th>
                <th>Qty</th>
                <th>UOM</th>
                <th>Rate</th>
                <th>Amount</th>
                <th>Tax</th>
                <th>Total</th>
                <th>Frame / Serial No</th>
            </tr>
        </thead>
        <tbody>
            {% for item in doc.items %}
            <tr>
                <td class="text-center">{{ loop.index }}</td>
                <td class="text-center">{{ item.item_code }}</td>
                <td>{{ item.item_name }}</td>
                <td class="text-center">{{ item.qty }}</td>
                <td class="text-center">{{ item.uom }}</td>
                <td class="text-right">{{ frappe.format(item.rate, {"fieldtype":"Currency"}) }}</td>
                <td class="text-right">{{ frappe.format(item.amount, {"fieldtype":"Currency"}) }}</td>
                <td class="text-right">{{ frappe.format(item.tax_amount or 0, {"fieldtype":"Currency"}) }}</td>
                <td class="text-right">{{ frappe.format((item.amount or 0) + (item.tax_amount or 0), {"fieldtype":"Currency"}) }}</td>
                <td class="serial">{{ item.serial_no or "-" }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- TOTALS -->
    <table class="totals">
        <tr>
            <td class="label">Net Total</td>
            <td class="value">{{ frappe.format(doc.net_total, {"fieldtype":"Currency"}) }}</td>
        </tr>
        <tr>
            <td class="label">Taxes & Charges</td>
            <td class="value">{{ frappe.format(doc.total_taxes_and_charges, {"fieldtype":"Currency"}) }}</td>
        </tr>
        <tr class="grand">
            <td class="label">Grand Total</td>
            <td class="value">{{ frappe.format(doc.grand_total, {"fieldtype":"Currency"}) }}</td>
        </tr>
    </table>

    <!-- FOOTER -->
    <div class="footer">
        <div>
            <b>Declaration:</b><br>
            We declare that the particulars given above are true and correct.
        </div>
        <div style="text-align:right;">
            For {{ company.company_name }}<br><br>
            Authorised Signatory
        </div>
    </div>

</div>


